<?php
class Twig_Sandbox_SecurityPolicy implements Twig_Sandbox_SecurityPolicyInterface { protected $allowedTags; protected $allowedFilters; protected $allowedMethods; protected $allowedProperties; protected $allowedFunctions; public function __construct(array $sp41728c = array(), array $sp429418 = array(), array $spf90d38 = array(), array $spae77c8 = array(), array $sp27f433 = array()) { $this->allowedTags = $sp41728c; $this->allowedFilters = $sp429418; $this->setAllowedMethods($spf90d38); $this->allowedProperties = $spae77c8; $this->allowedFunctions = $sp27f433; } public function setAllowedTags(array $sp53db34) { $this->allowedTags = $sp53db34; } public function setAllowedFilters(array $sp34c924) { $this->allowedFilters = $sp34c924; } public function setAllowedMethods(array $sp2c061e) { $this->allowedMethods = array(); foreach ($sp2c061e as $spbd0159 => $sp02cfae) { $this->allowedMethods[$spbd0159] = array_map('strtolower', is_array($sp02cfae) ? $sp02cfae : array($sp02cfae)); } } public function setAllowedProperties(array $sp05be97) { $this->allowedProperties = $sp05be97; } public function setAllowedFunctions(array $spbe1c61) { $this->allowedFunctions = $spbe1c61; } public function checkSecurity($sp53db34, $sp34c924, $spbe1c61) { foreach ($sp53db34 as $sp836199) { if (!in_array($sp836199, $this->allowedTags)) { throw new Twig_Sandbox_SecurityNotAllowedTagError(sprintf('Tag "%s" is not allowed.', $sp836199), $sp836199); } } foreach ($sp34c924 as $sp4a901b) { if (!in_array($sp4a901b, $this->allowedFilters)) { throw new Twig_Sandbox_SecurityNotAllowedFilterError(sprintf('Filter "%s" is not allowed.', $sp4a901b), $sp4a901b); } } foreach ($spbe1c61 as $sp9b51b9) { if (!in_array($sp9b51b9, $this->allowedFunctions)) { throw new Twig_Sandbox_SecurityNotAllowedFunctionError(sprintf('Function "%s" is not allowed.', $sp9b51b9), $sp9b51b9); } } } public function checkMethodAllowed($sp1bd56d, $sp810c92) { if ($sp1bd56d instanceof Twig_TemplateInterface || $sp1bd56d instanceof Twig_Markup) { return true; } $sp819100 = false; $sp810c92 = strtolower($sp810c92); foreach ($this->allowedMethods as $spbd0159 => $sp2c061e) { if ($sp1bd56d instanceof $spbd0159) { $sp819100 = in_array($sp810c92, $sp2c061e); break; } } if (!$sp819100) { throw new Twig_Sandbox_SecurityError(sprintf('Calling "%s" method on a "%s" object is not allowed.', $sp810c92, get_class($sp1bd56d))); } } public function checkPropertyAllowed($sp1bd56d, $sp805c76) { $sp819100 = false; foreach ($this->allowedProperties as $spbd0159 => $sp05be97) { if ($sp1bd56d instanceof $spbd0159) { $sp819100 = in_array($sp805c76, is_array($sp05be97) ? $sp05be97 : array($sp05be97)); break; } } if (!$sp819100) { throw new Twig_Sandbox_SecurityError(sprintf('Calling "%s" property on a "%s" object is not allowed.', $sp805c76, get_class($sp1bd56d))); } } }