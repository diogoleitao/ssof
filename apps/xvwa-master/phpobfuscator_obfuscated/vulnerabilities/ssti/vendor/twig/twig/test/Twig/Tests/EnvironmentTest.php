<?php
class Twig_Tests_EnvironmentTest extends PHPUnit_Framework_TestCase { public function testRenderNoLoader() { $spf4b92b = new Twig_Environment(); $spf4b92b->render('test'); } public function testAutoescapeOption() { $spdfb5a9 = new Twig_Loader_Array(array('html' => '{{ foo }} {{ foo }}', 'js' => '{{ bar }} {{ bar }}')); $speae043 = new Twig_Environment($spdfb5a9, array('debug' => true, 'cache' => false, 'autoescape' => array($this, 'escapingStrategyCallback'))); $this->assertEquals('foo&lt;br/ &gt; foo&lt;br/ &gt;', $speae043->render('html', array('foo' => 'foo<br/ >'))); $this->assertEquals('foo\\x3Cbr\\x2F\\x20\\x3E foo\\x3Cbr\\x2F\\x20\\x3E', $speae043->render('js', array('bar' => 'foo<br/ >'))); } public function escapingStrategyCallback($sp79b407) { return $sp79b407; } public function testGlobals() { $speae043 = new Twig_Environment($this->getMock('Twig_LoaderInterface')); $speae043->addGlobal('foo', 'foo'); $speae043->getGlobals(); $speae043->addGlobal('foo', 'bar'); $sp718c8c = $speae043->getGlobals(); $this->assertEquals('bar', $sp718c8c['foo']); $speae043 = new Twig_Environment($this->getMock('Twig_LoaderInterface')); $speae043->addGlobal('foo', 'foo'); $speae043->getGlobals(); $speae043->initRuntime(); $speae043->addGlobal('foo', 'bar'); $sp718c8c = $speae043->getGlobals(); $this->assertEquals('bar', $sp718c8c['foo']); $speae043 = new Twig_Environment($this->getMock('Twig_LoaderInterface')); $speae043->addGlobal('foo', 'foo'); $speae043->getGlobals(); $speae043->getFunctions(); $speae043->addGlobal('foo', 'bar'); $sp718c8c = $speae043->getGlobals(); $this->assertEquals('bar', $sp718c8c['foo']); $speae043 = new Twig_Environment($spdfb5a9 = new Twig_Loader_Array(array('index' => '{{foo}}'))); $speae043->addGlobal('foo', 'foo'); $speae043->getGlobals(); $speae043->getFunctions(); $speae043->initRuntime(); $speae043->addGlobal('foo', 'bar'); $sp718c8c = $speae043->getGlobals(); $this->assertEquals('bar', $sp718c8c['foo']); $speae043 = new Twig_Environment($spdfb5a9); $speae043->getGlobals(); $speae043->addGlobal('foo', 'bar'); $spe32893 = $speae043->loadTemplate('index'); $this->assertEquals('bar', $spe32893->render(array())); } public function testExtensionsAreNotInitializedWhenRenderingACompiledTemplate() { $sp44f03d = array('cache' => sys_get_temp_dir() . '/twig', 'auto_reload' => false, 'debug' => false); $speae043 = new Twig_Environment($spdfb5a9 = new Twig_Loader_Array(array('index' => '{{ foo }}')), $sp44f03d); $sp1f2d15 = $speae043->getCacheFilename('index'); if (!is_dir(dirname($sp1f2d15))) { mkdir(dirname($sp1f2d15), 511, true); } file_put_contents($sp1f2d15, $speae043->compileSource('{{ foo }}', 'index')); $speae043 = $this->getMockBuilder('Twig_Environment')->setConstructorArgs(array($spdfb5a9, $sp44f03d))->setMethods(array('initExtensions'))->getMock(); $speae043->expects($this->never())->method('initExtensions'); $sp35fa7e = $speae043->render('index', array('foo' => 'bar')); $this->assertEquals('bar', $sp35fa7e); unlink($sp1f2d15); } public function testAddExtension() { $speae043 = new Twig_Environment($this->getMock('Twig_LoaderInterface')); $speae043->addExtension(new Twig_Tests_EnvironmentTest_Extension()); $this->assertArrayHasKey('test', $speae043->getTags()); $this->assertArrayHasKey('foo_filter', $speae043->getFilters()); $this->assertArrayHasKey('foo_function', $speae043->getFunctions()); $this->assertArrayHasKey('foo_test', $speae043->getTests()); $this->assertArrayHasKey('foo_unary', $speae043->getUnaryOperators()); $this->assertArrayHasKey('foo_binary', $speae043->getBinaryOperators()); $this->assertArrayHasKey('foo_global', $speae043->getGlobals()); $sp6563f4 = $speae043->getNodeVisitors(); $this->assertEquals('Twig_Tests_EnvironmentTest_NodeVisitor', get_class($sp6563f4[2])); } public function testRemoveExtension() { $speae043 = new Twig_Environment($this->getMock('Twig_LoaderInterface')); $speae043->addExtension(new Twig_Tests_EnvironmentTest_Extension()); $speae043->removeExtension('environment_test'); $this->assertFalse(array_key_exists('test', $speae043->getTags())); $this->assertFalse(array_key_exists('foo_filter', $speae043->getFilters())); $this->assertFalse(array_key_exists('foo_function', $speae043->getFunctions())); $this->assertFalse(array_key_exists('foo_test', $speae043->getTests())); $this->assertFalse(array_key_exists('foo_unary', $speae043->getUnaryOperators())); $this->assertFalse(array_key_exists('foo_binary', $speae043->getBinaryOperators())); $this->assertFalse(array_key_exists('foo_global', $speae043->getGlobals())); $this->assertCount(2, $speae043->getNodeVisitors()); } } class Twig_Tests_EnvironmentTest_Extension extends Twig_Extension { public function getTokenParsers() { return array(new Twig_Tests_EnvironmentTest_TokenParser()); } public function getNodeVisitors() { return array(new Twig_Tests_EnvironmentTest_NodeVisitor()); } public function getFilters() { return array(new Twig_SimpleFilter('foo_filter', 'foo_filter')); } public function getTests() { return array(new Twig_SimpleTest('foo_test', 'foo_test')); } public function getFunctions() { return array(new Twig_SimpleFunction('foo_function', 'foo_function')); } public function getOperators() { return array(array('foo_unary' => array()), array('foo_binary' => array())); } public function getGlobals() { return array('foo_global' => 'foo_global'); } public function getName() { return 'environment_test'; } } class Twig_Tests_EnvironmentTest_TokenParser extends Twig_TokenParser { public function parse(Twig_Token $sp650e38) { } public function getTag() { return 'test'; } } class Twig_Tests_EnvironmentTest_NodeVisitor implements Twig_NodeVisitorInterface { public function enterNode(Twig_NodeInterface $spcefb62, Twig_Environment $spf4b92b) { return $spcefb62; } public function leaveNode(Twig_NodeInterface $spcefb62, Twig_Environment $spf4b92b) { return $spcefb62; } public function getPriority() { return 0; } }