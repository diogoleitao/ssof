<?php
abstract class Twig_Node_Expression_Call extends Twig_Node_Expression { protected function compileCallable(Twig_Compiler $spa1c015) { $sp5f2826 = false; if ($this->hasAttribute('callable') && ($sp9a2590 = $this->getAttribute('callable'))) { if (is_string($sp9a2590)) { $spa1c015->raw($sp9a2590); } elseif (is_array($sp9a2590) && $sp9a2590[0] instanceof Twig_ExtensionInterface) { $spa1c015->raw(sprintf('$this->env->getExtension(\'%s\')->%s', $sp9a2590[0]->getName(), $sp9a2590[1])); } else { $sp32ff7e = ucfirst($this->getAttribute('type')); $spa1c015->raw(sprintf('call_user_func_array($this->env->get%s(\'%s\')->getCallable(), array', $sp32ff7e, $this->getAttribute('name'))); $sp5f2826 = true; } } else { $spa1c015->raw($this->getAttribute('thing')->compile()); } $this->compileArguments($spa1c015); if ($sp5f2826) { $spa1c015->raw(')'); } } protected function compileArguments(Twig_Compiler $spa1c015) { $spa1c015->raw('('); $sp94ea74 = true; if ($this->hasAttribute('needs_environment') && $this->getAttribute('needs_environment')) { $spa1c015->raw('$this->env'); $sp94ea74 = false; } if ($this->hasAttribute('needs_context') && $this->getAttribute('needs_context')) { if (!$sp94ea74) { $spa1c015->raw(', '); } $spa1c015->raw('$context'); $sp94ea74 = false; } if ($this->hasAttribute('arguments')) { foreach ($this->getAttribute('arguments') as $spe65765) { if (!$sp94ea74) { $spa1c015->raw(', '); } $spa1c015->string($spe65765); $sp94ea74 = false; } } if ($this->hasNode('node')) { if (!$sp94ea74) { $spa1c015->raw(', '); } $spa1c015->subcompile($this->getNode('node')); $sp94ea74 = false; } if ($this->hasNode('arguments') && null !== $this->getNode('arguments')) { $sp9a2590 = $this->hasAttribute('callable') ? $this->getAttribute('callable') : null; $spc5cc06 = $this->getArguments($sp9a2590, $this->getNode('arguments')); foreach ($spc5cc06 as $spcefb62) { if (!$sp94ea74) { $spa1c015->raw(', '); } $spa1c015->subcompile($spcefb62); $sp94ea74 = false; } } $spa1c015->raw(')'); } protected function getArguments($sp9a2590, $spc5cc06) { $sp2a7f3c = $this->getAttribute('type'); $spe787db = $this->getAttribute('name'); $sp30a3d4 = array(); $sp2a60bc = false; foreach ($spc5cc06 as $sp3eec35 => $spcefb62) { if (!is_int($sp3eec35)) { $sp2a60bc = true; $sp3eec35 = $this->normalizeName($sp3eec35); } elseif ($sp2a60bc) { throw new Twig_Error_Syntax(sprintf('Positional arguments cannot be used after named arguments for %s "%s".', $sp2a7f3c, $spe787db)); } $sp30a3d4[$sp3eec35] = $spcefb62; } $spd21a47 = $this->hasAttribute('is_variadic') && $this->getAttribute('is_variadic'); if (!$sp2a60bc && !$spd21a47) { return $sp30a3d4; } if (!$sp9a2590) { if ($sp2a60bc) { $sp9f2d02 = sprintf('Named arguments are not supported for %s "%s".', $sp2a7f3c, $spe787db); } else { $sp9f2d02 = sprintf('Arbitrary positional arguments are not supported for %s "%s".', $sp2a7f3c, $spe787db); } throw new LogicException($sp9f2d02); } if (is_array($sp9a2590)) { $sp693624 = new ReflectionMethod($sp9a2590[0], $sp9a2590[1]); } elseif (is_object($sp9a2590) && !$sp9a2590 instanceof Closure) { $sp693624 = new ReflectionObject($sp9a2590); $sp693624 = $sp693624->getMethod('__invoke'); } elseif (is_string($sp9a2590) && false !== strpos($sp9a2590, '::')) { $sp693624 = new ReflectionMethod($sp9a2590); } else { $sp693624 = new ReflectionFunction($sp9a2590); } $spb50136 = $sp693624->getParameters(); if ($this->hasNode('node')) { array_shift($spb50136); } if ($this->hasAttribute('needs_environment') && $this->getAttribute('needs_environment')) { array_shift($spb50136); } if ($this->hasAttribute('needs_context') && $this->getAttribute('needs_context')) { array_shift($spb50136); } if ($this->hasAttribute('arguments') && null !== $this->getAttribute('arguments')) { foreach ($this->getAttribute('arguments') as $spe65765) { array_shift($spb50136); } } if ($spd21a47) { $spe65765 = end($spb50136); if ($spe65765 && $spe65765->isArray() && $spe65765->isDefaultValueAvailable() && array() === $spe65765->getDefaultValue()) { array_pop($spb50136); } else { $sp95ef1e = $sp693624->name; if ($sp693624->getDeclaringClass()) { $sp95ef1e = $sp693624->getDeclaringClass()->name . '::' . $sp95ef1e; } throw new LogicException(sprintf('The last parameter of "%s" for %s "%s" must be an array with default value, eg. "array $arg = array()".', $sp95ef1e, $sp2a7f3c, $spe787db)); } } $spc5cc06 = array(); $sp5d289c = array(); $sp396ea7 = array(); $sp33a06c = array(); $spd8e1fc = 0; foreach ($spb50136 as $spf1e79d) { $sp5d289c[] = $sp3eec35 = $this->normalizeName($spf1e79d->name); if (array_key_exists($sp3eec35, $sp30a3d4)) { if (array_key_exists($spd8e1fc, $sp30a3d4)) { throw new Twig_Error_Syntax(sprintf('Argument "%s" is defined twice for %s "%s".', $sp3eec35, $sp2a7f3c, $spe787db)); } if (!empty($sp396ea7)) { throw new Twig_Error_Syntax(sprintf('Argument "%s" could not be assigned for %s "%s(%s)" because it is mapped to an internal PHP function which cannot determine default value for optional argument%s "%s".', $sp3eec35, $sp2a7f3c, $spe787db, implode(', ', $sp5d289c), count($sp396ea7) > 1 ? 's' : '', implode('", "', $sp396ea7))); } $spc5cc06 = array_merge($spc5cc06, $sp33a06c); $spc5cc06[] = $sp30a3d4[$sp3eec35]; unset($sp30a3d4[$sp3eec35]); $sp33a06c = array(); } elseif (array_key_exists($spd8e1fc, $sp30a3d4)) { $spc5cc06 = array_merge($spc5cc06, $sp33a06c); $spc5cc06[] = $sp30a3d4[$spd8e1fc]; unset($sp30a3d4[$spd8e1fc]); $sp33a06c = array(); ++$spd8e1fc; } elseif ($spf1e79d->isDefaultValueAvailable()) { $sp33a06c[] = new Twig_Node_Expression_Constant($spf1e79d->getDefaultValue(), -1); } elseif ($spf1e79d->isOptional()) { if (empty($sp30a3d4)) { break; } else { $sp396ea7[] = $sp3eec35; } } else { throw new Twig_Error_Syntax(sprintf('Value for argument "%s" is required for %s "%s".', $sp3eec35, $sp2a7f3c, $spe787db)); } } if ($spd21a47) { $spb7e9b8 = new Twig_Node_Expression_Array(array(), -1); foreach ($sp30a3d4 as $spd888fc => $spbb4d96) { if (is_int($spd888fc)) { $spb7e9b8->addElement($spbb4d96); } else { $spb7e9b8->addElement($spbb4d96, new Twig_Node_Expression_Constant($spd888fc, -1)); } unset($sp30a3d4[$spd888fc]); } if ($spb7e9b8->count()) { $spc5cc06 = array_merge($spc5cc06, $sp33a06c); $spc5cc06[] = $spb7e9b8; } } if (!empty($sp30a3d4)) { $sp462d18 = null; foreach ($sp30a3d4 as $sp43d8a1) { if ($sp43d8a1 instanceof Twig_Node) { $sp462d18 = $sp43d8a1; break; } } throw new Twig_Error_Syntax(sprintf('Unknown argument%s "%s" for %s "%s(%s)".', count($sp30a3d4) > 1 ? 's' : '', implode('", "', array_keys($sp30a3d4)), $sp2a7f3c, $spe787db, implode(', ', $sp5d289c)), $sp462d18 ? $sp462d18->getLine() : -1); } return $spc5cc06; } protected function normalizeName($sp3eec35) { return strtolower(preg_replace(array('/([A-Z]+)([A-Z][a-z])/', '/([a-z\\d])([A-Z])/'), array('\\1_\\2', '\\1_\\2'), $sp3eec35)); } }